---
title: "Scenario Plots"
author: "Greg Macfarlane"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup}
library(knitr)
opts_chunk$set(fig.width=8, fig.height=6)
```

I have been tasked with coming up with a convenient method for digesting the 
results of a SWIM model run. I think the best thing to do is to create a series 
of helper functions that will create plots or calculate metrics on tables pulled
directly from the database. I have wrapped these functions in an Rpackage that I
am calling `swimr`.


```{r load_swimr}
library(swimr)
```

The package relies on `dplyr`, `ggplot2`, and other modern R packages. These
should be installed by default, but I use them for lots of things so I'll load
them here.

```{r load_libraries, message=FALSE, warning=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
```

One advantage of the `dplyr` package is that it can work on the SQLite database
directly. For more information, see the `dplyr`
[vignette](http://cran.r-project.org/web/packages/dplyr/vignettes/databases.html).

```{r point_to_db}
db_path <- "~/Documents/projects/swim/FinalReference_Test.db"
db <- src_sqlite(db_path)
db
```

The functions have been written in such a way that they can aggregate
to MPO, State, or County. Additionally, the user can select a set of those
fields to show. 
```{r set_facets}
facet <- "COUNTY"
counties <- c("Multnomah", "Washington", "Clackamas")
```

# Single Scenario

## Population and Employment

The `plot_sevar()` function makes a plot like Alex's, comparing population and 
employment in a county. It draws control tables from a `data_frame` included
with the package. You can also compare multiple counties.


```{r plot_sevar}
plot_sevar(db, facet, counties)
```

The employment information takes a long time to gather. I don't have the number
of jobs directly in the database, but I do have output by 

```{r plot_employment}
plot_employment(db, facet, counties)
```


## Floorspace

```{r floorspace}
plot_floorspace(db, facet, counties)
```


## Traffic


## Trips
```{r trips}
plot_trips(db, facet, counties, share = TRUE)
plot_trips(db, facet, counties, share = FALSE)
```

## VMT/VHT
```{r vmt}
plot_vmt(db, facet, counties)
```

```{r vht}
plot_vht(db, facet, counties)
```

## Congestion
```{r congested}
plot_pct_cong(db, facet, counties)
```

# Compare scenarios

```{r two_scenarios}
db1 <- src_sqlite("~/Documents/projects/swim/FinalReference_Test.db")
db2 <- src_sqlite("~/Documents/projects/swim/skim_hold.db")
```

## Economics

```{r compare_floorspace}
compare_floorspace(db1, db2, facet, counties)
```

```{r compare_employment}
compare_employment(db1, db2, facet, counties)
```

```{r compare_sedata}
compare_sevar(db1, db2, facet, counties)
```

## Transportation
```{r compare_trips}
compare_trips(db1, db2, facet, counties)
```

